(()=>{"use strict";class e{constructor(e){this.name=e.name,this.due=e.due,this.desc=e.desc,this.priority=e.priority,this.id=e.id,this.completed=!1}}class t{constructor(e,t,n=null){null==n?(this.name=e,this.tasks=[],this.id=t):(this.name=n.name,this.tasks=n.tasks,this.id=n.id)}add_task(e){this.tasks.push(e)}remove_task(e){this.tasks.splice(this.tasks.findIndex((t=>e.id==t.id)),1)}}const n=[];let[i,o]=function(){let e=JSON.parse(localStorage.getItem("projs"));return null==e||0==e.length?[1,-1]:[e[e.length-1].id+1,+localStorage.getItem("task_id")]}(),a=document.querySelector(".projects"),s=document.querySelector("#create-project button"),l=document.querySelector("#create-project input");function d(t){let i=document.createElement("div");i.classList.add("project"),i.id=t.id,a.append(i);let s=document.createElement("span");s.classList.add("title"),s.textContent=t.name;let l=document.createElement("ul");i.append(s,l,function(t){let i=document.createElement("div");i.classList.add("btn-container");let a=document.createElement("button");a.textContent="+ add task";let s=document.createElement("button");return s.textContent="- remove project",s.classList.add("red-button"),i.append(a,s),a.addEventListener("click",(a=>{!function(t,i){let a=document.getElementById(t.id).querySelector("form");null==a?(a=document.createElement("form"),a.innerHTML='\n            <label for="task_name">Name: </label>\n            <input type="text" id="task_name" name="name" value="Untitled task">\n            <label for="due">Due: </label>\n            <input type="date" id="due" name="due">\n            <label for="desc">Description: </label>\n            <textarea id="desc" cols="30" rows="10" name="desc"></textarea>\n            <label for="priority">Priority: </label>\n            <select id="priority" name="priority">\n                <option>Low</option>\n                <option selected>Medium</option>\n                <option>High</option>\n            </select>\n            <button>Done</button>\n        ',a.addEventListener("submit",(i=>{i.preventDefault(),r(t,function(t,i){const a=t.querySelector("#task_name").value;let s=t.querySelector("#due").value;""==s&&(s="N/A");const l={name:a,due:s,desc:t.querySelector("#desc").value,priority:t.querySelector("#priority").value,id:o};t.remove();let d=new e(l);return i.add_task(d),o--,localStorage.setItem("task_id",String(o)),localStorage.setItem("projs",JSON.stringify(n)),d}(a,t))})),i.append(a)):a.classList.toggle("hidden")}(t,i)})),s.addEventListener("click",(e=>{confirm("Remove project?")&&(n.splice(n.findIndex((e=>e.id==t.id)),1),document.getElementById(t.id).remove(),localStorage.setItem("projs",JSON.stringify(n)))})),i}(t))}function r(e,t){let i=document.getElementById(e.id).querySelector("ul"),o=document.createElement("li");o.classList.add("task"),o.id=t.id,o.textContent=t.name,o.addEventListener("click",(a=>{!function(e,t,i,o){const a=`[data-id="${o.id}"]`;let s=t.querySelector(a);if(null==s){let t=function(e,t,i){let o=document.createElement("div");o.classList.add("task-clicked"),o.dataset.id=i.id;let[a,s,l]=function(e){let t=document.createElement("div"),n=document.createElement("span");n.textContent="Due: ",n.classList.add("task-info"),t.append(n),n.insertAdjacentText("afterend",e.due);let i=document.createElement("div"),o=document.createElement("span");o.textContent="Description: ",o.classList.add("task-info"),i.append(o),o.insertAdjacentText("afterend",e.desc);let a=document.createElement("div"),s=document.createElement("span");s.textContent="Priority: ",s.classList.add("task-info"),a.append(s),s.insertAdjacentText("afterend",e.priority);const l=[t,i,a];if(e.completed)for(let e of l)e.classList.toggle("line-through");return[t,i,a]}(t),d=function(e,t,i,o,a){let s=document.createElement("div");s.style.cssText="display: flex; gap: 3px;";let l=document.createElement("button"),d=document.createElement("button");return t.completed?(l.textContent="Mark unfinished",l.classList.add("red-button")):l.textContent="Mark finished",d.textContent="Delete task",d.classList.add("red-button"),l.addEventListener("click",(e=>{!function(e,t,i){e.completed=!e.completed,localStorage.setItem("projs",JSON.stringify(n));for(let e of i)e.classList.toggle("line-through");t.classList.toggle("red-button"),t.textContent="Mark finished"==t.textContent?"Mark unfinished":"Mark finished"}(t,l,o)})),d.addEventListener("click",(o=>{confirm("Delete task?")&&function(e,t,i,o){e.remove_task(t),i.remove(),o.remove(),localStorage.setItem("projs",JSON.stringify(n))}(e,t,i,a)})),s.append(l,d),s}(e,t,i,[a,s,l],o);return o.append(d,a,s,l),o}(e,i,o);o.insertAdjacentElement("afterend",t)}else s.classList.toggle("hidden")}(e,i,t,o)})),i.append(o)}!function(){let e=JSON.parse(localStorage.getItem("projs"));if(null!=e)for(let i of e){i=new t(i.name,i.id,i),n.push(i),d(i);for(let e of i.tasks)r(i,e)}}(),s.addEventListener("click",(e=>{let a;a=""==l.value?new t("untitled project",i):new t(l.value,i),i++,n.push(a),localStorage.setItem("task_id",String(o)),localStorage.setItem("projs",JSON.stringify(n)),d(a)}))})();