(()=>{"use strict";class e{constructor(e){this.name=e.name,this.due=e.due,this.desc=e.desc,this.priority=e.priority,this.id=e.id,this.completed=!1}}class t{constructor(e,t,n=null){null==n?(this.name=e,this.tasks=[],this.id=t):(this.name=n.name,this.tasks=n.tasks,this.id=n.id)}add_task(e){this.tasks.push(e)}remove_task(e){this.tasks.splice(this.tasks.findIndex((t=>e.id==t.id)),1)}}const n=[];let[a,i]=function(){let e=JSON.parse(localStorage.getItem("projs"));return null==e||0==e.length?[1,-1]:[e[e.length-1].id+1,+localStorage.getItem("task_id")]}(),o=document.querySelector(".projects"),s=document.querySelector("#create-project button"),d=document.querySelector("#create-project input");function l(t){let a=document.createElement("div");a.classList.add("project"),a.id=t.id,o.append(a);let s=document.createElement("span");s.classList.add("title"),s.textContent=t.name;let d=document.createElement("ul");a.append(s,d,function(t){let a=document.createElement("div");a.classList.add("btn-container");let o=document.createElement("button");o.textContent="+ add task";let s=document.createElement("button");return s.textContent="- remove project",s.classList.add("red-button"),a.append(o,s),o.addEventListener("click",(o=>{!function(t,a){let o=document.getElementById(t.id).querySelector("form");null==o?(o=document.createElement("form"),o.innerHTML='\n            <label for="task_name">Name: </label>\n            <input type="text" id="task_name" name="name" value="Untitled task">\n            <label for="due">Due: </label>\n            <input type="date" id="due" name="due">\n            <label for="desc">Description: </label>\n            <textarea id="desc" cols="30" rows="10" name="desc"></textarea>\n            <label for="priority">Priority: </label>\n            <select id="priority" name="priority">\n                <option>Low</option>\n                <option selected>Medium</option>\n                <option>High</option>\n            </select>\n            <button>Done</button>\n        ',o.addEventListener("submit",(a=>{a.preventDefault(),r(t,function(t,a){const o=t.querySelector("#task_name").value;let s=t.querySelector("#due").value;""==s&&(s="N/A");const d={name:o,due:s,desc:t.querySelector("#desc").value,priority:t.querySelector("#priority").value,id:i};t.remove();let l=new e(d);return a.add_task(l),i--,localStorage.setItem("task_id",String(i)),localStorage.setItem("projs",JSON.stringify(n)),l}(o,t))})),a.append(o)):o.classList.toggle("hidden")}(t,a)})),s.addEventListener("click",(e=>{n.splice(n.findIndex((e=>e.id==t.id)),1),document.getElementById(t.id).remove(),localStorage.setItem("projs",JSON.stringify(n))})),a}(t))}function r(e,t){let a=document.getElementById(e.id).querySelector("ul"),i=document.createElement("li");i.classList.add("task"),i.id=t.id,i.textContent=t.name,i.addEventListener("click",(o=>{!function(e,t,a,i){const o=`[data-id="${i.id}"]`;let s=t.querySelector(o);if(null==s){let t=function(e,t,a){let i=document.createElement("div");i.classList.add("task-clicked"),i.dataset.id=a.id;let[o,s,d]=function(e){let t=document.createElement("div"),n=document.createElement("span");n.textContent="Due: ",n.classList.add("task-info"),t.append(n),n.insertAdjacentText("afterend",e.due);let a=document.createElement("div"),i=document.createElement("span");i.textContent="Description: ",i.classList.add("task-info"),a.append(i),i.insertAdjacentText("afterend",e.desc);let o=document.createElement("div"),s=document.createElement("span");s.textContent="Priority: ",s.classList.add("task-info"),o.append(s),s.insertAdjacentText("afterend",e.priority);const d=[t,a,o];if(e.completed)for(let e of d)e.classList.toggle("line-through");return[t,a,o]}(t),l=function(e,t,a,i,o){let s=document.createElement("div");s.style.cssText="display: flex; gap: 3px;";let d=document.createElement("button"),l=document.createElement("button");return t.completed?(d.textContent="Mark unfinished",d.classList.add("red-button")):d.textContent="Mark finished",l.textContent="Delete task",l.classList.add("red-button"),d.addEventListener("click",(e=>{!function(e,t,a){e.completed=!e.completed,localStorage.setItem("projs",JSON.stringify(n));for(let e of a)e.classList.toggle("line-through");t.classList.toggle("red-button"),t.textContent="Mark finished"==t.textContent?"Mark unfinished":"Mark finished"}(t,d,i)})),l.addEventListener("click",(i=>{!function(e,t,a,i){e.remove_task(t),a.remove(),i.remove(),localStorage.setItem("projs",JSON.stringify(n))}(e,t,a,o)})),s.append(d,l),s}(e,t,a,[o,s,d],i);return i.append(l,o,s,d),i}(e,a,i);i.insertAdjacentElement("afterend",t)}else s.classList.toggle("hidden")}(e,a,t,i)})),a.append(i)}!function(){let e=JSON.parse(localStorage.getItem("projs"));if(null!=e)for(let a of e){a=new t(a.name,a.id,a),n.push(a),l(a);for(let e of a.tasks)r(a,e)}}(),s.addEventListener("click",(e=>{let o;o=""==d.value?new t("untitled project",a):new t(d.value,a),a++,n.push(o),localStorage.setItem("task_id",String(i)),localStorage.setItem("projs",JSON.stringify(n)),l(o)}))})();